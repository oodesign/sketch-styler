var _require = require('child_process'),
    exec = _require.exec;

var coscript = require('coscript');

var makeCommand = function makeCommand(_ref) {
  var bundleURL = _ref.bundleURL,
      identifier = _ref.identifier;

  var delegate = 'COScript.app("Sketch").delegate()';
  var url = 'NSURL.fileURLWithPath("' + String(bundleURL) + '")';
  return delegate + '.runPluginCommandWithIdentifier_fromBundleAtURL("' + String(identifier) + '", ' + url + ')';
};

var runPluginCommand = function runPluginCommand(options) {
  return new Promise(function (resolve, reject) {
    exec('"' + String(coscript) + '" -e \'' + String(makeCommand(options)) + '\'', function (err, stdout, stderr) {
      if (err) {
        reject(err);
      }

      resolve({ stdout: stdout, stderr: stderr });
    });
  });
};

module.exports = runPluginCommand;